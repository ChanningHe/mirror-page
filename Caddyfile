:80 {
    # Serve static files from the 'out' directory generated by Next.js export
    root * /app/out
    
    # Enable file server for browsing
    file_server
    
    # Handle SPA routing - not strictly needed for static export but good practice
    try_files {path} {path}/ {path}.html /index.html

    # Serve mirror files from /data/mirrors under a specific path or fallback
    # Since we want to serve the generated static site AND the mirror files:
    
    # Approach: Serve the static site as primary, but map specific paths to mirror data if needed
    # However, the original config had "root * /data/mirrors" and proxy for Next.js
    # Now we likely want the index page to be our static site, and other paths to be mirrors?
    
    # Let's refine:
    # The user wants "direct deployment via Nginx or Caddy".
    # Typically this means:
    # / -> serves the static index.html from Next.js
    # /_next/* -> serves static assets
    # /<mirror-name> -> serves the actual mirror content from /data/mirrors
    
    # Let's define the static site root
    handle /_next/* {
        root * /app/out
        file_server
    }
    
    handle /favicon.svg {
        root * /app/out
        file_server
    }

    # Serve the index page
    handle / {
        root * /app/out
        try_files /index.html
        file_server
    }
    
    # Serve the index page for explicit index.html request
    handle /index.html {
        root * /app/out
        file_server
    }

    # Everything else serves from the mirror data directory
    handle {
        root * /data/mirrors
        file_server browse {
            hide .git
        }
    }
}
